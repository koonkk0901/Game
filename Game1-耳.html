<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§€é³¥å°åµæ¢</title>
    <!-- å¼•å…¥ Tailwind CSS ä»¥ä¾¿å¿«é€Ÿè¨­è¨ˆç¾è§€çš„ UI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ç¢ºä¿éŠæˆ²ç‰ˆé¢æ°¸é ä¿æŒ 4:3 æ¯”ä¾‹ï¼Œä¸¦é©æ‡‰è¢å¹•å¤§å° */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* é˜²æ­¢æ•´å€‹ç¶²é å‡ºç¾æ²å‹•æ¢ï¼Œç¢ºä¿å®Œæ•´é¡¯ç¤º */
        }
        .game-wrapper {
            width: 100vw;
            height: 100dvh; /* å‹•æ…‹è¦–çª—é«˜åº¦ï¼Œå®Œç¾å°æ‡‰ iPad Safari éš±è—/é¡¯ç¤ºç¶²å€åˆ— */
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f3f4f6; /* å¤–åœç°åº•ï¼Œå‡¸é¡¯éŠæˆ²æ¡† */
            padding: 10px;
            box-sizing: border-box;
        }
        .game-box {
            /* é–å®š 4:3 æ¯”ä¾‹ï¼Œä¸¦æ ¹æ“šè¢å¹•è‡ªå‹•æœ€å¤§åŒ–ï¼Œçµ•ä¸è¶…å‡ºç•«é¢ */
            aspect-ratio: 4 / 3;
            width: 100%;
            height: 100%;
            max-width: calc((100dvh - 20px) * 4 / 3);
            max-height: calc((100vw - 20px) * 3 / 4);
            border-radius: 1.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            position: relative;
        }
        
        /* å¯æ„›ç«‹é«”æŒ‰éˆ•è¨­è¨ˆ */
        .btn-play {
            box-shadow: 0 6px 0 #b45309; /* æ·±æ©™è‰²é™°å½± */
            transition: all 0.1s;
        }
        .btn-play:active {
            box-shadow: 0 0px 0 #b45309;
            transform: translateY(6px);
        }
        
        .btn-next {
            box-shadow: 0 6px 0 #7e22ce; /* æ·±ç´«è‰²é™°å½± */
            transition: all 0.1s;
        }
        .btn-next:active {
            box-shadow: 0 0px 0 #7e22ce;
            transform: translateY(6px);
        }

        /* å¡ç‰‡äº’å‹•æ•ˆæœ */
        .bird-card {
            transition: all 0.2s ease-in-out;
        }
        .bird-card:hover:not(:disabled) {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: #34d399; /* hoveræ™‚é¡¯ç¤ºç¶ è‰²é‚Šæ¡† */
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <!-- éŠæˆ²ä¸»å®¹å™¨ï¼ŒèƒŒæ™¯é¡è‰²æœƒé€é JS å‹•æ…‹æ”¹è®Š -->
        <div id="game-root" class="game-box">
            <!-- å…§å®¹å°‡ç”± JavaScript æ³¨å…¥ -->
        </div>
    </div>

    <script>
        // è¨­å®šé³¥é¡è³‡æ–™åº« (ä½¿ç”¨ GitHub Raw é€£çµ)
        const birds = [
            {
                id: 'dove',
                name: 'ç é ¸æ–‘é³©',
                audio: 'https://raw.githubusercontent.com/koonkk0901/Game/main/%E7%8F%A0%E9%A0%B8%E6%96%91%E9%B3%A9.mp3',
                img: 'https://raw.githubusercontent.com/koonkk0901/Game/main/%E7%8F%A0%E9%A0%B8%E6%96%91%E9%B3%A9.png'
            },
            {
                id: 'cockatoo',
                name: 'å°è‘µèŠ±é³³é ­é¸šéµ¡',
                audio: 'https://raw.githubusercontent.com/koonkk0901/Game/main/%E5%B0%8F%E8%91%B5%E8%8A%B1%E9%B3%B3%E9%A0%AD%E9%B8%9A%E9%B5%A1.mp3',
                img: 'https://raw.githubusercontent.com/koonkk0901/Game/main/%E5%B0%8F%E8%91%B5%E8%8A%B1%E9%B3%B3%E9%A0%AD%E9%B8%9A%E9%B5%A1.png'
            },
            {
                id: 'koel',
                name: 'å™ªéµ‘',
                audio: 'https://raw.githubusercontent.com/koonkk0901/Game/main/%E5%99%AA%E9%B5%91.mp3',
                img: 'https://raw.githubusercontent.com/koonkk0901/Game/main/%E5%99%AA%E9%B5%91.png'
            }
        ];

        // éŠæˆ²ç‹€æ…‹è®Šæ•¸
        let currentTarget = null;
        let wrongGuesses = [];
        let showError = false;
        let audioElements = {};
        let currentAudio = null;
        let clapAudio = null; // æ–°å¢æ‹æ‰‹éŸ³æ•ˆè®Šæ•¸
        
        // å¢å¼·éŸ³é‡å°ˆç”¨è®Šæ•¸ (Web Audio API)
        let audioCtx = null; 
        let isAudioRouted = false; 

        // åˆå§‹åŒ–éŠæˆ²ï¼šé è¼‰å…¥éŸ³æ•ˆä¸¦é–‹å§‹æ–°ä¸€å±€
        function initGame() {
            birds.forEach(b => {
                let a = new Audio(b.audio);
                a.crossOrigin = "anonymous"; // å…è¨±é€²éšéŸ³æ•ˆè™•ç†ä»¥çªç ´éŸ³é‡ä¸Šé™
                a.preload = 'auto'; // é å…ˆåŠ è¼‰è²éŸ³
                audioElements[b.id] = a;
            });
            
            // é è¼‰å…¥æ‹æ‰‹è² (ä½¿ç”¨ Raw é€£çµ)
            clapAudio = new Audio('https://raw.githubusercontent.com/koonkk0901/Game/main/%E6%8B%8D%E6%89%8B.mp3');
            clapAudio.preload = 'auto';
            clapAudio.volume = 0.5; // éŸ³é‡æ¸›ç´°50%

            startNewRound();
        }

        // é–‹å§‹æ–°å›åˆ
        function startNewRound() {
            wrongGuesses = [];
            showError = false;
            
            // åœæ­¢æ‹æ‰‹è²ï¼ˆå¦‚æœé‚„åœ¨æ’­æ”¾ï¼‰
            if (clapAudio) {
                clapAudio.pause();
                clapAudio.currentTime = 0;
            }

            // éš¨æ©ŸæŠ½é¸ä¸€éš»ç›®æ¨™é³¥é¡
            currentTarget = birds[Math.floor(Math.random() * birds.length)];
            renderMainScreen();
        }

        // æ’­æ”¾è²éŸ³
        function playSound() {
            // åœ¨ä½¿ç”¨è€…ç¬¬ä¸€æ¬¡é»æ“Šæ™‚ï¼Œå•Ÿå‹•éŸ³æ•ˆå¢ç›Šå¼•æ“ (çªç ´ç€è¦½å™¨é è¨­çš„ 100% éŸ³é‡é™åˆ¶)
            if (!isAudioRouted) {
                try {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    birds.forEach(b => {
                        let a = audioElements[b.id];
                        let source = audioCtx.createMediaElementSource(a);
                        let gainNode = audioCtx.createGain();
                        
                        // å°‡å°è‘µèŠ±é³³é ­é¸šéµ¡çš„éŸ³é‡å¢å¤§ 50% (å¢ç›Šå€¼è¨­ç‚º 1.5)
                        if (b.id === 'cockatoo') {
                            gainNode.gain.value = 1.5;
                        } else {
                            gainNode.gain.value = 1.0;
                        }
                        
                        source.connect(gainNode);
                        gainNode.connect(audioCtx.destination);
                    });
                    isAudioRouted = true;
                } catch (e) {
                    console.warn("éŸ³æ•ˆå¢ç›Šåˆå§‹åŒ–å¤±æ•—ï¼Œå°‡ä½¿ç”¨ä¸€èˆ¬éŸ³é‡", e);
                }
            }

            // å–šé†’éŸ³æ•ˆå¼•æ“ (å› æ‡‰ç€è¦½å™¨çš„è‡ªå‹•æ’­æ”¾å®‰å…¨é™åˆ¶)
            if (audioCtx && audioCtx.state === 'suspended') {
                audioCtx.resume();
            }

            // å¦‚æœå·²æœ‰è²éŸ³åœ¨æ’­æ”¾ï¼Œå…ˆæš«åœä¸¦é‡ç½®
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            currentAudio = audioElements[currentTarget.id];
            
            const playPromise = currentAudio.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    // å¦‚æœæ˜¯å› ç‚ºå¿«é€Ÿé»æ“Šå°è‡´ä¸­æ–·æ’­æ”¾ (AbortError)ï¼Œå‰‡å®‰å…¨å¿½ç•¥
                    if (error.name !== 'AbortError') {
                        console.error("æ’­æ”¾éŸ³æ•ˆå¤±æ•—:", error);
                    }
                });
            }
        }

        // åœæ­¢è²éŸ³
        function stopSound() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
        }

        // è™•ç†å­¸ç”Ÿé»æ“Šç­”æ¡ˆ
        function handleGuess(birdId) {
            if (birdId === currentTarget.id) {
                // ç­”å°äº†
                stopSound();
                renderSuccessScreen();
            } else {
                // ç­”éŒ¯äº†
                if (!wrongGuesses.includes(birdId)) {
                    wrongGuesses.push(birdId);
                }
                showError = true;
                renderMainScreen(); // é‡æ–°æ¸²æŸ“ç•«é¢ä»¥é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯å’Œä½¿éŒ¯èª¤é¸é …è®Šç°
            }
        }

        // æ¸²æŸ“ä¸»éŠæˆ²ç•«é¢ (ç²‰ç¶ è‰²åº•)
        function renderMainScreen() {
            const root = document.getElementById('game-root');
            // è¨­å®šç²‰ç¶ è‰²èƒŒæ™¯ (#e6f4ea)
            root.className = "game-box bg-[#e6f4ea] flex flex-col pt-4 md:pt-6 px-4";

            // éŒ¯èª¤è¨Šæ¯å€å¡Š (å¢åŠ ä¸Šæ–¹ marginï¼Œå°‡æ–‡å­—ä½ç½®ä¸‹ç§»ç´„10%)
            const errorHtml = showError
                ? `<div class="text-red-500 font-bold text-lg md:text-xl h-6 md:h-8 mt-2 md:mt-3 flex items-center justify-center drop-shadow-sm leading-tight">è§€é³¥å°åµæ¢: è«‹å†è½å¤šä¸€æ¬¡!</div>`
                : `<div class="text-transparent font-bold text-lg md:text-xl h-6 md:h-8 mt-2 md:mt-3 flex items-center justify-center pointer-events-none select-none leading-tight">ä¿ç•™ç©ºé–“</div>`;

            // é³¥é¡é¸æ“‡å¡ç‰‡ (å°‡ç™½è‰²å…§è·èˆ‡ç¶ è‰²èƒŒæ™¯çš„é–“è·ç¸®å°ç´„30%)
            const cardsHtml = birds.map(b => {
                const isWrong = wrongGuesses.includes(b.id);
                if (isWrong) {
                    // ç­”éŒ¯çš„ç‹€æ…‹ï¼šåŠé€æ˜ã€ç°è‰²ã€ç„¡æ³•é»æ“Š
                    return `
                        <button disabled class="bg-white rounded-3xl p-1.5 md:p-3 shadow-sm border-4 border-gray-200 opacity-50 grayscale flex flex-col items-center justify-center h-full w-full cursor-not-allowed min-h-0">
                            <div class="bg-emerald-50 w-full rounded-2xl p-1 md:p-2 mb-1 md:mb-2 flex-1 flex items-center justify-center min-h-0 overflow-hidden">
                                <img src="${b.img}" alt="${b.name}" class="w-full h-full object-contain drop-shadow-md">
                            </div>
                            <div class="text-center text-base md:text-2xl font-bold text-gray-400 leading-tight">${b.name}</div>
                        </button>
                    `;
                } else {
                    // æ­£å¸¸å¯é»æ“Šç‹€æ…‹
                    return `
                        <button onclick="handleGuess('${b.id}')" class="bird-card bg-white rounded-3xl p-1.5 md:p-3 shadow-md border-4 border-transparent flex flex-col items-center justify-center h-full w-full cursor-pointer focus:outline-none min-h-0">
                            <div class="bg-emerald-50 w-full rounded-2xl p-1 md:p-2 mb-1 md:mb-2 flex-1 flex items-center justify-center min-h-0 overflow-hidden">
                                <img src="${b.img}" alt="${b.name}" class="w-full h-full object-contain drop-shadow-md">
                            </div>
                            <div class="text-center text-base md:text-2xl font-bold text-gray-700 leading-tight">${b.name}</div>
                        </button>
                    `;
                }
            }).join('');

            // çµ„åˆ HTML (æ•´é«”æ–‡å­—è¡Œè·åŠ ä¸Š leading-tightï¼Œä¸¦å°‡é‚Šè· mb/pb æ•¸å€¼æŒ‰æ¯”ä¾‹ç¸®æ¸›)
            root.innerHTML = `
                <div class="text-center mb-1.5 md:mb-3">
                    <div class="text-sm md:text-base text-emerald-700 font-bold mb-0.5 leading-tight">2025-2026 ç§‘å­¸ç§‘ é¦™æ¸¯çœŸå…‰ä¸­å­¸é™„å±¬å°å­¸æš¨å¹¼ç¨šåœ’</div>
                    <h1 class="text-xl md:text-3xl font-black text-emerald-800 tracking-wide mb-1 leading-tight">ğŸ•µï¸â€â™‚ï¸ è§€é³¥å°åµæ¢ æŠ€èƒ½è§£é–éä¸‰é—œ ğŸ•µï¸â€â™€ï¸</h1>
                    <h2 class="text-lg md:text-xl font-bold text-emerald-600 leading-tight">ğŸ‘‚ è†è½æŠ€èƒ½è§£é– ğŸ”“</h2>
                </div>
                
                <div class="flex flex-col items-center justify-center mb-2 md:mb-4">
                    <button onclick="playSound()" class="btn-play bg-yellow-400 hover:bg-yellow-300 text-yellow-900 font-bold py-1.5 md:py-2 px-7 md:px-10 rounded-full text-lg md:text-2xl focus:outline-none tracking-widest leading-tight">
                        ç™¼å‡ºé³¥é³´è² ğŸ”Š
                    </button>
                    ${errorHtml}
                </div>

                <div class="grid grid-cols-3 gap-2 md:gap-4 flex-1 px-2 md:px-8 pb-3 md:pb-4">
                    ${cardsHtml}
                </div>
                
                <div class="w-full text-center pb-1.5 md:pb-2 text-xs md:text-sm text-emerald-700/70 font-semibold tracking-wider leading-tight">
                    2025-2026 ç§‘å­¸ç§‘ é¦™æ¸¯çœŸå…‰ä¸­å­¸é™„å±¬å°å­¸æš¨å¹¼ç¨šåœ’
                </div>
            `;
        }

        // æ¸²æŸ“æˆåŠŸç•«é¢ (ç²‰ç´…è‰²åº•)
        function renderSuccessScreen() {
            // æ’­æ”¾æ‹æ‰‹è²
            if (clapAudio) {
                clapAudio.currentTime = 0;
                const clapPromise = clapAudio.play();
                if (clapPromise !== undefined) {
                    clapPromise.catch(e => {
                        if (e.name !== 'AbortError') {
                            console.error("æ’­æ”¾æ‹æ‰‹è²å¤±æ•—:", e);
                        }
                    });
                }
            }

            const root = document.getElementById('game-root');
            // è¨­å®šç²‰ç´…è‰²èƒŒæ™¯ (#fce4ec)
            root.className = "game-box bg-[#fce4ec] flex flex-col items-center justify-center p-6 md:p-8";

            root.innerHTML = `
                <div class="flex-1 flex flex-col items-center justify-center w-full">
                    <div class="text-7xl md:text-8xl mb-4 md:mb-7 animate-bounce">ğŸ‰ğŸ•µï¸â€â™‚ï¸ğŸ•µï¸â€â™€ï¸ğŸ‰</div>
                    <h1 class="text-4xl md:text-6xl font-black text-pink-500 mb-5 text-center leading-tight drop-shadow-sm">
                        è§€é³¥å°åµæ¢:<br>è†è½æŠ€èƒ½è§£é–æˆåŠŸï¼
                    </h1>
                </div>
                <div class="w-full flex justify-center pb-4 md:pb-7">
                    <button onclick="startNewRound()" class="btn-next bg-purple-500 hover:bg-purple-400 text-white font-bold py-3 md:py-4 px-10 md:px-16 rounded-full text-2xl md:text-3xl focus:outline-none tracking-wider leading-tight">
                        ä¸‹ä¸€ä½è§€é³¥å°åµæ¢ â”
                    </button>
                </div>
                
                <div class="w-full text-center pb-1.5 md:pb-2 text-xs md:text-sm text-pink-700/70 font-semibold tracking-wider leading-tight">
                    2025-2026 ç§‘å­¸ç§‘ é¦™æ¸¯çœŸå…‰ä¸­å­¸é™„å±¬å°å­¸æš¨å¹¼ç¨šåœ’
                </div>
            `;
        }

        // ç•¶ç¶²é è¼‰å…¥å®Œæˆå¾Œå•Ÿå‹•éŠæˆ²
        window.onload = initGame;
    </script>
</body>
</html>